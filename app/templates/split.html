{% extends "base.html" %}

{% block title %}Dividir PDF{% endblock %}

{% block header_text %}
  <h2>Dividir PDF</h2>
{% endblock %}

{% block content %}
<main>
  <div class="container">
    {% set prefix = 'split' %}

    <section class="card card--glass">
      <div class="dropzone-container">
        <div
          id="dropzone-{{ prefix }}"
          class="dropzone"
          data-preview="#preview-{{ prefix }}"
          data-spinner="#spinner-{{ prefix }}"
          data-action="#btn-{{ prefix }}"
          data-extensions=".pdf"
          data-multiple="false"
        >
          <input
            type="file"
            id="input-{{ prefix }}"
            name="file"
            accept="application/pdf,.pdf"
            class="dz-input-overlay"
            aria-label="Selecionar PDF para dividir"
          >
          <span>Arraste o arquivo aqui ou clique para selecionar</span>
        </div>
      </div>

      <div id="spinner-{{ prefix }}" class="overlay-spinner hidden" aria-hidden="true">
        <div class="loader"></div>
      </div>

      <div class="actions" data-no-drag>
        <button id="btn-{{ prefix }}" type="button" class="btn btn-primary" disabled>
          Dividir PDF
        </button>

        <!-- separa todas as páginas (gera ZIP) -->
        <button id="btn-split-all" type="button" class="btn btn-secondary" disabled>
          Separar todas as páginas
        </button>

        <button id="btn-clear-all" type="button"
                class="btn btn-tertiary btn-icon"
                title="Limpar tudo" aria-label="Limpar tudo">
          <svg class="icon" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="1.8"
               stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M16 3l5 5-9 9H8L3 12l9-9z"></path>
            <path d="M8 21h8" stroke-width="1.5"></path>
          </svg>
        </button>
      </div>

      <div class="info-callout info-callout--mini" role="note" aria-label="Como dividir PDF">
        <ul class="mini-steps">
          <li>Envie <strong>1 PDF</strong></li>
          <li>Marque as <strong>páginas</strong> desejadas</li>
          <li>Opcional: gire / exclua</li>
          <li>Clique <strong>Dividir PDF</strong> ou <strong>Separar todas as páginas</strong></li>
        </ul>
        <details class="more more--inline">
          <summary>Observações</summary>
          <ul>
            <li>Se nada for marcado e você usar <em>Separar todas as páginas</em>, será baixado um ZIP.</li>
            <li>PDFs com senha podem falhar.</li>
          </ul>
        </details>
      </div>

      <!-- Preview por página -->
      <div
        id="preview-{{ prefix }}"
        class="preview-grid mt-preview thumb-list thumb-grid"
        data-sortable="true"
        data-prefix="{{ prefix }}"
        aria-live="polite"
        aria-label="Pré-visualização e seleção das páginas do PDF"
        role="listbox"
        aria-multiselectable="true">
      </div>
    </section>

    <div class="loading-area">
      <div id="mensagem-feedback" class="hidden"></div>
      <div id="loading-spinner" class="hidden">Processando...</div>
      <div id="progress-container" class="progress-container hidden">
        <div id="progress-bar" class="progress-bar"></div>
      </div>
    </div>

    <div class="btn-wrapper nav-buttons">
      <a href="{{ url_for('index') }}"           class="btn btn-secondary">Página Inicial</a>
      <a href="{{ url_for('converter_page') }}"  class="btn btn-secondary">Conversão</a>
      <a href="{{ url_for('merge_page') }}"      class="btn btn-secondary">Juntar PDFs</a>
      <a href="{{ url_for('split_page') }}"      class="btn btn-secondary" aria-current="page">Dividir PDF</a>
      <a href="{{ url_for('compress_page') }}"   class="btn btn-secondary">Comprimir PDF</a>
    </div>
  </div>
</main>
{% endblock %}

{% block scripts %}
  <!-- pdf.js -->
  <script nonce="{{ csp_nonce() }}" src="{{ url_for('static', filename='pdfjs/pdf.min.js') }}"></script>
  <script nonce="{{ csp_nonce() }}" src="{{ url_for('static', filename='js/pdf-config.js') }}"></script>

  <!-- Seleção/UX das miniaturas (arquivo externo; sem inline) -->
  <script nonce="{{ csp_nonce() }}" src="{{ url_for('static', filename='js/split-ui.js') }}" defer></script>

  <!-- Bootstrap global -->
  <script nonce="{{ csp_nonce() }}" type="module" src="{{ url_for('static', filename='js/script.js') }}" defer></script>

  <!-- Módulo específico da página -->
  <script nonce="{{ csp_nonce() }}" type="module" src="{{ url_for('static', filename='js/split-page.js') }}" defer></script>
{% endblock %}