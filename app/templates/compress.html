{% extends "base.html" %}

{% block title %}Comprimir PDF{% endblock %}

{% block header_text %}
  <h2>Comprimir PDF</h2>
{% endblock %}

{% block content %}
<main>
  <div class="container">
    {% set prefix = 'compress' %}

    <!-- üëá habilita o modo compacto via SCSS -->
    <section class="card card--glass card--compact">
      <label for="input-{{ prefix }}">Escolha um arquivo PDF:</label>

      <div class="dropzone-container">
        <div
          id="dropzone-{{ prefix }}"
          class="dropzone"
          data-preview="#preview-{{ prefix }}"
          data-spinner="#spinner-{{ prefix }}"
          data-action="#btn-{{ prefix }}"
          data-extensions=".pdf"
          data-multiple="false"
        >
          <input
            type="file"
            id="input-{{ prefix }}"
            name="file"
            accept=".pdf"
            class="dz-input-overlay"
            aria-label="Selecionar PDF para comprimir"
          >
          <span>Arraste o arquivo aqui ou clique para selecionar</span>
        </div>
      </div>

      <!-- Perfil de compress√£o -->
      <div class="field mt-3">
        <label for="profile">Qualidade da compress√£o</label>
        <select id="profile" name="profile" aria-describedby="profile-hint">
          <option value="equilibrio"
                  data-hint="Boa qualidade em tela com tamanho reduzido (‚âà150 dpi). Melhor custo/benef√≠cio."
                  selected>
            Equil√≠brio (recomendado)
          </option>
          <option value="mais-leve"
                  data-hint="M√°xima redu√ß√£o. Pode baixar a qualidade de imagens (‚âà72‚Äì96 dpi). Ideal para envio r√°pido.">
            Arquivo menor (web/e-mail)
          </option>
          <option value="alta-qualidade"
                  data-hint="Preserva detalhes (‚âà300 dpi). Arquivo maior. Bom para impress√£o.">
            Alta qualidade (impress√£o)
          </option>
          <option value="sem-perdas"
                  data-hint="N√£o reamostra imagens; apenas otimiza/compacta fluxos. Usa fallback seguro.">
            Sem perdas (seguro)
          </option>
        </select>
        <small id="profile-hint" class="form-hint">
          Boa qualidade em tela com tamanho reduzido (‚âà150 dpi). Melhor custo/benef√≠cio.
        </small>
      </div>

      <!-- Explica√ß√£o vis√≠vel/SEO -->
      <details class="profile-explain mt-2">
        <summary>O que cada op√ß√£o faz?</summary>
        <ul>
          <li><strong>Equil√≠brio (recomendado)</strong>: boa qualidade em tela (‚âà150 dpi) com tamanho reduzido.</li>
          <li><strong>Arquivo menor (web/e-mail)</strong>: compress√£o m√°xima (‚âà72‚Äì96 dpi); pode degradar imagens finas.</li>
          <li><strong>Alta qualidade (impress√£o)</strong>: preserva detalhes (‚âà300 dpi); arquivo maior.</li>
          <li><strong>Sem perdas (seguro)</strong>: n√£o reamostra imagens; apenas otimiza fluxos e mant√©m fallback seguro.</li>
        </ul>
      </details>

      <div id="spinner-{{ prefix }}" class="overlay-spinner hidden" aria-hidden="true">
        <div class="loader"></div>
      </div>

      <div class="actions">
        <button id="btn-{{ prefix }}" type="button" class="btn btn-primary" disabled>
          Comprimir PDF
        </button>

        <button id="btn-clear-all" type="button"
                class="btn btn-secondary btn-icon"
                title="Limpar tudo" aria-label="Limpar tudo">
          <svg class="icon" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="1.8"
               stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M16 3l5 5-9 9H8L3 12l9-9z"></path>
            <path d="M8 21h8" stroke-width="1.5"></path>
          </svg>
        </button>
      </div>

      <div id="preview-{{ prefix }}" class="preview-grid mt-preview"></div>
    </section>

    <div class="loading-area">
      <div id="mensagem-feedback" class="hidden"></div>
      <div id="loading-spinner" class="hidden">Processando...</div>
      <div id="progress-container" class="progress-container hidden">
        <div id="progress-bar" class="progress-bar"></div>
      </div>
    </div>

    <div class="btn-wrapper nav-buttons">
      <a href="{{ url_for('index') }}" class="btn btn-secondary">P√°gina Inicial</a>
      <a href="{{ url_for('converter_page') }}" class="btn btn-secondary">Convers√£o</a>
      <a href="{{ url_for('merge_page') }}" class="btn btn-secondary">Juntar PDFs</a>
      <a href="{{ url_for('split_page') }}" class="btn btn-secondary">Dividir PDF</a>
    </div>
  </div>
</main>
{% endblock %}

{% block scripts %}
  <script nonce="{{ csp_nonce() }}" type="module" src="{{ url_for('static', filename='pdfjs/pdf.min.js') }}" defer></script>
  <script nonce="{{ csp_nonce() }}" type="module" src="{{ url_for('static', filename='pdfjs/pdf.worker.min.js') }}" defer></script>
  <script nonce="{{ csp_nonce() }}" type="module" src="{{ url_for('static', filename='js/pdf-config.js') }}" defer></script>
  <script nonce="{{ csp_nonce() }}" type="module" src="{{ url_for('static', filename='js/script.js') }}" defer></script>
  <!-- Atualiza o texto de ajuda do perfil -->
  <script nonce="{{ csp_nonce() }}" type="module" src="{{ url_for('static', filename='js/compress.js') }}" defer></script>
{% endblock %}