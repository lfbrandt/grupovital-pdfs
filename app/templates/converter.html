{% extends "base.html" %}

{% block title %}Conversão para PDF{% endblock %}

{% block header_text %}
  <h2>Converter arquivos para PDF</h2>
{% endblock %}

{% block content %}
<main class="with-preview">
  <div class="container">
    {% set prefix = 'convert' %}

    <section class="card card--glass">
      <div class="upload-preview-wrapper">
        <!-- ESQUERDA: dropzone + botão + link de download -->
        <div class="dropzone-container">
          <div
            id="dropzone-{{ prefix }}"
            class="dropzone"
            data-spinner="#spinner-{{ prefix }}"
            data-action="#btn-convert-all"
            data-extensions=".doc,.docx,.odt,.rtf,.txt,.html,.xls,.xlsx,.ods,.ppt,.pptx,.odp,.jpg,.jpeg,.png,.bmp,.tiff"
            data-multiple="true"
          >
            <input
              type="file"
              id="input-{{ prefix }}"
              name="file"
              accept=".doc,.docx,.odt,.rtf,.txt,.html,.xls,.xlsx,.ods,.ppt,.pptx,.odp,.jpg,.jpeg,.png,.bmp,.tiff"
              multiple
              class="dz-input-overlay"
              aria-label="Selecionar arquivos para conversão"
            >
            <span>Arraste os arquivos aqui ou clique para selecionar</span>
          </div>

          <div id="spinner-{{ prefix }}" class="overlay-spinner hidden" aria-hidden="true">
            <div class="loader"></div>
          </div>

          <button id="btn-convert-all" type="button" class="btn btn-primary" disabled>
            Converter Todos
          </button>

          <!-- Link de download (mostrado após sucesso) -->
          <div id="link-download-container" class="hidden under-action">
            <p class="download-line">
              <span class="muted">Arquivo convertido:</span>
              <a id="download-link" href="#" target="_blank" download>Baixar PDF</a>
            </p>
          </div>
        </div>

        <!-- DIREITA: PREVIEW DO PDF CONVERTIDO (RESULTADO) -->
        <div class="preview-column">
          <!-- IMPORTANTE: usar .preview-grid -->
          <div id="preview-convert" class="preview-grid mt-preview" data-mode="result"></div>
        </div>
      </div>
    </section>

    <!-- NAV -->
    <div class="btn-wrapper nav-buttons">
      <a href="{{ url_for('index') }}"           class="btn btn-secondary">Página Inicial</a>
      <a href="{{ url_for('converter_page') }}"  class="btn btn-secondary">Conversão</a>
      <a href="{{ url_for('merge_page') }}"      class="btn btn-secondary">Juntar PDFs</a>
      <a href="{{ url_for('split_page') }}"      class="btn btn-secondary">Dividir PDF</a>
    </div>
  </div>
</main>
{% endblock %}

{% block scripts %}
  <!-- PDF.js global + configuração do worker -->
  <script nonce="{{ csp_nonce() }}" src="{{ url_for('static', filename='pdfjs/pdf.min.js') }}"></script>
  <script nonce="{{ csp_nonce() }}" src="{{ url_for('static', filename='js/pdf-config.js') }}"></script>

  <!-- Entrypoint da página -->
  <script nonce="{{ csp_nonce() }}" type="module" src="{{ url_for('static', filename='js/script.js') }}" defer></script>
{% endblock %}