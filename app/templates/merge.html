{% extends "base.html" %}
{% block title %}Juntar os PDFs{% endblock %}
{% block body_attrs %}data-page="merge"{% endblock %}

{% block header_text %}
  <h2>Juntar os PDFs</h2>
{% endblock %}

{% block content %}
<div id="merge-page">
  <main class="merge-main">
    {% set prefix = 'merge' %}

    <div class="merge-layout merge-layout--with-sidebar">
      <!-- WORKSPACE (esquerda) -->
      <section class="workspace" aria-label="Área de trabalho">

        <!-- Upload + ações lado a lado -->
        <div class="workspace-header">
          <div class="dropzone-container">
            <div
              id="dropzone-{{ prefix }}"
              class="dropzone"
              data-preview="#preview-{{ prefix }}"
              data-spinner="#spinner-{{ prefix }}"
              data-action="#btn-{{ prefix }}"
              data-extensions=".pdf"
              data-multiple="true"
            >
              <input
                type="file"
                id="input-{{ prefix }}"
                name="files"
                accept="application/pdf,.pdf"
                multiple
                class="dz-input-overlay"
                aria-label="Selecionar PDFs para juntar"
              >
              <span>Arraste os arquivos aqui ou clique para selecionar</span>
            </div>
          </div>

          <div class="actions actions--inline" data-no-drag>
            <button id="btn-{{ prefix }}" type="button" class="btn btn-primary" disabled>
              Juntar PDFs
            </button>

            <button id="btn-clear-all" type="button"
                    class="btn btn-tertiary btn-icon"
                    title="Limpar tudo" aria-label="Limpar tudo">
              <svg class="icon" viewBox="0 0 24 24" fill="none"
                   stroke="currentColor" stroke-width="1.8"
                   stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M16 3l5 5-9 9H8L3 12l9-9z"></path>
                <path d="M8 21h8" stroke-width="1.5"></path>
              </svg>
            </button>
          </div>
        </div>

        <div id="spinner-{{ prefix }}" class="overlay-spinner hidden" aria-hidden="true">
          <div class="loader"></div>
        </div>

        <!-- GRID DE MINIATURAS — fica na faixa branca -->
        <div
          id="preview-{{ prefix }}"
          class="preview-grid thumb-list thumb-grid"
          data-sortable="true"
          data-prefix="{{ prefix }}"
          aria-live="polite"
          aria-label="Pré-visualização e ordenação dos PDFs e páginas"
          role="listbox"
          aria-multiselectable="true">
        </div>

        <!-- Dicas (abaixo do grid) -->
        <div class="info-callout info-callout--mini" role="note" aria-label="Como juntar PDFs">
          <ul class="mini-steps">
            <li>Envie <strong>2+ PDFs</strong></li>
            <li>Arraste para <strong>ordenar os arquivos</strong> e/ou <strong>páginas</strong></li>
            <li>(Opcional) selecione páginas específicas</li>
            <li>Clique <strong>Juntar PDFs</strong></li>
          </ul>
          <details class="more more--inline">
            <summary>Observações</summary>
            <ul>
              <li>PDFs com senha podem falhar.</li>
              <li>Respeita os limites desta instalação.</li>
              <li>Se não baixar, habilite pop-ups.</li>
            </ul>
          </details>
        </div>
      </section>

      <!-- SIDEBAR (direita) — aparece só depois do upload -->
      <aside id="sidebar" class="tool__sidebar" aria-label="Organizar pdf" hidden aria-hidden="true">
        <header class="tool__sidebar__header">
          <h3>Organizar pdf</h3>
          <button id="btn-reset-files" class="link-reset" type="button">Redefinir tudo</button>
        </header>

        <div class="tool__sidebar__body">
          <div class="files-header">Arquivos:</div>
          <ol id="file-list" class="file-list" role="listbox" aria-label="Arquivos (arraste para reordenar)">
            <!-- itens criados pelo merge-sidebar.js -->
          </ol>
        </div>

        <footer class="tool__sidebar__footer">
          <button id="btn-organize-apply" type="button" class="btn btn-danger btn-lg">
            Organizar
          </button>
        </footer>
      </aside>
    </div>

    <!-- NAV -->
    <div class="btn-wrapper nav-buttons">
      <a href="{{ url_for('index') }}"                        class="btn btn-secondary">Página Inicial</a>
      <a href="{{ url_for('converter.converter_page') }}"     class="btn btn-secondary">Conversão</a>
      <a href="{{ url_for('split_page') }}"                   class="btn btn-secondary">Dividir PDF</a>
      <a href="{{ url_for('edit_bp.edit') }}"                 class="btn btn-secondary">Editar PDF</a>
      <a href="{{ url_for('compress_page') }}"                class="btn btn-secondary">Comprimir PDF</a>
    </div>
  </main>
</div>
{% endblock %}

{% block scripts %}
  <script nonce="{{ csp_nonce() }}" src="{{ url_for('static', filename='pdfjs/pdf.min.js') }}" defer></script>
  <script nonce="{{ csp_nonce() }}" src="{{ url_for('static', filename='js/pdf-config.js') }}" defer></script>
  <script nonce="{{ csp_nonce() }}" src="{{ url_for('static', filename='js/utils.js') }}" defer></script>
  <script nonce="{{ csp_nonce() }}" src="{{ url_for('static', filename='js/merge-page.js') }}" defer></script>
  <script nonce="{{ csp_nonce() }}" src="{{ url_for('static', filename='js/merge-sidebar.js') }}" defer></script>
{% endblock %}