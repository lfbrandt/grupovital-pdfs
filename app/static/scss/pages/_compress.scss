/* ==========================================================================
   Página /compress — thumbs polidas, rotação suave e grid A4 (IDÊNTICO ao /merge)
   - Mantém apenas ações: Remover (×) e Girar (↻)
   - Mesmo layout, tokens e microajustes do /merge
   ========================================================================== */

/* ---- Esconde cabeçalhos/legados dentro do preview (igual /merge) ---- */
#preview-compress .file-name,
#preview-compress .thumb-title,
#preview-compress .title-bar,
#preview-compress .thumb-header,
#preview-compress .page-title,
#preview-compress .thumbbar {
  display: none !important;
}

/* Respiro abaixo da dropzone (mesma regra do merge/split) */
.card.card--glass .dropzone-container { margin-bottom: .5rem; }

/* ---------------- Tokens / Grid raiz (mesmos valores do /merge) ---------------- */
#preview-compress {
  --thumb-w: 180px;                 /* largura fixa da célula */
  --thumb-gap: 12px;
  --a4-ratio: 1.41421356;           /* √2 (H = W*√2) */
  --card-h: calc(var(--thumb-w) * var(--a4-ratio));

  display: grid !important;
  grid-template-columns: repeat(auto-fill, minmax(var(--thumb-w), var(--thumb-w)));
  grid-auto-rows: var(--card-h);    /* todas as células com mesma altura */
  gap: var(--thumb-gap);
  justify-content: start;
  align-content: start;
  grid-auto-flow: row dense;
  container-type: inline-size;
}

/* Se o template envolver itens em .file-wrapper/.preview-grid, "achata" p/ grid no root */
#preview-compress .file-wrapper,
#preview-compress .file-wrapper > .preview-grid { display: contents !important; }
#preview-compress > .file-wrapper {
  background: transparent; box-shadow: none; padding: 0;
}
#preview-compress > .file-wrapper > .file-controls,
#preview-compress > .file-wrapper > .file-name { display: none; }

/* ---------------- Card base (igual ao /merge) ---------------- */
#preview-compress .page-wrapper.page-thumb {
  display: block !important;
  position: relative !important;
  inline-size: var(--thumb-w);
  block-size: var(--card-h);

  border-radius: .75rem;
  background: #fff;
  box-shadow: 0 1px 2px rgba(0,0,0,.06);
  overflow: hidden;
  transition: box-shadow .18s ease, transform .18s ease;
  outline: 0;

  /* isola layout/pintura para não “vazar” */
  contain: layout paint;

  &:hover { transform: translateY(-2px); box-shadow: 0 2px 8px rgba(0,0,0,.10); }
  &:focus-visible { box-shadow: 0 0 0 3px rgba(0,153,93,.35); }
  &.selected, &[aria-selected="true"] { box-shadow: 0 0 0 3px rgba(0,153,93,.60); }
}

/* Área da miniatura com proporção A4 (portrait) */
#preview-compress .thumb-frame{
  position: absolute;
  inset: 0;
  inline-size: 100%;
  block-size: 100%;
  background: #fff;
  overflow: hidden;
  display: block;
  will-change: transform;
  contain: paint;
}

/* Mídia absoluta e centralizada; tamanho/rotação vem do JS (scale+rotate) */
#preview-compress .thumb-media{
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  transform-origin: 50% 50%;
  backface-visibility: hidden;
  transition: transform .18s ease, filter .18s ease;
  display: block;
}

/* Resets para evitar “saltos” */
#preview-compress img.thumb-media,
#preview-compress canvas.thumb-media {
  max-width: none;
  height: auto;
  margin: 0;
  border: 0;
}

/* Micro anti-serrilhado em 90/270 (Chrome) — igual /merge */
@supports (filter: blur(0.001px)) {
  #preview-compress .thumb-media[style*="rotate(90deg)"],
  #preview-compress .thumb-media[style*="rotate(270deg)"] { filter: blur(0.001px); }
}

/* ---------------- Badges (Pg N) ---------------- */
#preview-compress .page-badge{
  position: absolute;
  inset-block-start: .35rem;
  inset-inline-start: .35rem;
  z-index: 3;
  font: 600 11px/1.2 var(--font, "Inter", system-ui, -apple-system);
  color: #fff;
  background: var(--gv-brand, #00995d);
  padding: 4px 8px;
  border-radius: 999px;
  box-shadow: 0 2px 6px rgba(0,0,0,.15);
}

/* ---------------- Controles (× e ↻) ---------------- */
#preview-compress .file-controls{
  position: absolute;
  inset-block-start: .35rem;
  inset-inline-end: .35rem;
  z-index: 4;
  display: inline-flex;
  gap: .35rem;

  .remove-file, .rotate-page{
    inline-size: 26px; block-size: 26px;
    border-radius: 999px; border: 0;
    display: grid; place-items: center;
    background: rgba(20,20,20,.78); color:#fff;
    cursor: pointer; font: inherit; line-height: 1;
    transition: transform .14s ease, opacity .14s ease, background .14s ease;
    &:hover { transform: scale(1.06); background: rgba(20,20,20,.92); }
    &:active{ transform: scale(.98); }
  }
}

/* Oculta botões órfãos/duplicados fora de .file-controls (igual /merge) */
#preview-compress .page-wrapper > .remove-file,
#preview-compress .page-wrapper > .rotate-page { display: none !important; }
#preview-compress .page-wrapper .file-controls ~ .file-controls { display: none !important; }

/* 🔒 Compress — manter SOMENTE remover (X) e girar (↻) mesmo que o HTML traga outros */
#preview-compress .thumb-actions > :not(.remove-file):not(.rotate-page),
#preview-compress .file-controls > :not(.remove-file):not(.rotate-page) {
  display: none !important;
}
/* Fallback robusto por data-action */
#preview-compress [data-action]:not([data-action="remove"]):not([data-action="rotate-right"]):not([data-action="rotate-left"]) {
  display: none !important;
}