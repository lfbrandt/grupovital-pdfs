/* ==========================================================================
   /merge — FULL-BLEED com SIDEBAR sticky, sem ultrapassar header/footer
   ========================================================================== */

:root {
  /* ↑ mais largo por padrão */
  --sidebar-w: clamp(420px, 36vw, 640px);
  --layout-gap: clamp(8px, 1.2vw, 16px);
  --outer-right: 0px;
  --header-h: 72px;
  --footer-h: 56px;

  /* tokens para o grid de thumbs */
  --gv-thumb-w: 200px;
  --gv-thumb-h: 200px;
  --gv-thumb-gap: 10px;

  --sidebar-offset-y: 0px;
}

#merge-page { width: 100%; }

/* Shell full-bleed */
#merge-page .merge-main {
  width: 100vw;
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);
  box-sizing: border-box;
  padding-left: var(--layout-gap);
  padding-right: var(--outer-right);
  padding-block: 8px;

  /* reserva para o footer global (para o sticky respeitar o limite) */
  padding-bottom: calc(var(--footer-h) + 12px + env(safe-area-inset-bottom));
  min-height: calc(100vh - var(--header-h) - var(--footer-h));
}

/* remove limites herdados */
#merge-page .container,
#merge-page .card,
#merge-page > .container,
#merge-page main > .container {
  max-width: none !important;
  width: 100% !important;
  padding: 0;
  margin: 0;
}

/* Layout: workspace | sidebar */
#merge-page .merge-layout {
  position: relative;
  display: grid;
  /* ↑ aumenta o mínimo e deixa crescer até --sidebar-w */
  grid-template-columns: 1fr minmax(420px, var(--sidebar-w));
  column-gap: var(--layout-gap);
  align-items: start;
  min-height: 0;
}
#merge-page .merge-layout .workspace { min-width: 0; }

/* === SIDEBAR STICKY – não passa do header nem do footer ================== */
#merge-page .merge-layout #sidebar {
  position: sticky !important;
  /* limite superior: logo abaixo do header */
  top: calc(var(--header-h) + 8px + var(--sidebar-offset-y));
  /* limite inferior: para antes do footer */
  bottom: calc(var(--footer-h) + 8px);
  /* altura máxima = viewport – header – footer – respiros/SAFEs */
  max-height: calc(
    100vh - var(--header-h) - var(--footer-h) - 24px
    - env(safe-area-inset-top) - env(safe-area-inset-bottom)
  );

  align-self: start;
  width: 100%;
  transform: none !important;
  right: auto; left: auto;
  z-index: 10;                 /* abaixo do header */

  display: flex;
  flex-direction: column;
  overflow: hidden;            /* o scroll fica no body interno */
}

/* Oculta → 1 coluna */
#sidebar[hidden] { display: none !important; }
#merge-page:has(#sidebar[hidden]) .merge-layout { grid-template-columns: 1fr; }
#merge-page.no-sidebar .merge-layout { grid-template-columns: 1fr; } /* fallback se precisar */

/* Aparência básica */
#sidebar.tool__sidebar {
  background: var(--surface, #fff);
  border: 1px solid var(--glass-border, rgba(0,0,0,.08));
  border-radius: 12px;
  box-shadow: var(--card-shadow, 0 4px 16px rgba(0,0,0,.08));
}

.tool__sidebar__header {
  position: sticky;
  top: 0;
  z-index: 2;
  display: flex; justify-content: space-between; align-items: center;
  padding: 12px 14px;
  background: var(--surface, #fff);
  border-bottom: 1px solid var(--glass-border, rgba(0,0,0,.08));
}
.tool__sidebar__header h3 { margin: 0; font: 700 1.1rem/1 system-ui, sans-serif; }

/* body rola e já reserva espaço para o footer global */
.tool__sidebar__body {
  flex: 1 1 auto;
  min-height: 0;
  overflow: auto;
  padding: 10px 14px;
  padding-bottom: calc(var(--footer-h) + 16px);
  scroll-padding-bottom: calc(var(--footer-h) + 16px);
}

.tool__sidebar__footer {
  padding: 12px 14px;
  border-top: 1px solid var(--glass-border, rgba(0,0,0,.08));
  background: var(--surface, #fff);
}

/* Workspace (upload + ações) */
.workspace { display: flex; flex-direction: column; gap: 12px; min-height: 0; }

.workspace-header {
  display: grid;
  grid-template-columns: minmax(340px, 1fr) max-content;
  align-items: center;
  gap: 16px;
}
.actions.actions--inline { display: inline-flex; gap: 10px; flex-wrap: wrap; }

/* Responsivo */
@media (max-width: 840px) {
  .workspace-header { grid-template-columns: 1fr; align-items: stretch; }
  .actions.actions--inline { justify-content: flex-start; }
}

/* Mobile: sidebar deixa de ser sticky */
@media (max-width: 1099px) {
  #merge-page .merge-main {
    width: 100%;
    margin-left: 0; margin-right: 0;
    padding-right: var(--layout-gap);
  }
  #merge-page .merge-layout { grid-template-columns: 1fr; }
  #merge-page .merge-main:has(#sidebar) { grid-template-columns: 1fr; }
  #sidebar.tool__sidebar {
    position: static !important;
    top: auto; bottom: auto;
    max-height: none;
    width: auto;
    z-index: 10;
  }
  .workspace { padding-right: 0; }
}

/* (opcional) perfis ainda mais largos ativando classe no <aside> */
.tool__sidebar--wide { --sidebar-w: clamp(520px, 40vw, 720px); }
.tool__sidebar--xl   { --sidebar-w: clamp(640px, 45vw, 820px); }