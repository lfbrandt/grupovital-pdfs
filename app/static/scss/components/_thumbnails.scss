/* ==========================================================================
   THUMBNAILS (Split/Merge/Compress/Edit) — versão unificada e compatível
   ========================================================================== */

:root{
  --thumb-w: 200px;
  --thumb-gap: 12px;
  --a4-ratio: 1.41421356;
  --card-h: calc(var(--thumb-w) * var(--a4-ratio));
}

/* -------------------- GRIDS -------------------- */
#preview-split {
  --thumb-w: var(--thumb-w);
  --thumb-gap: var(--thumb-gap);
  --a4-ratio: var(--a4-ratio);
  --card-h: calc(var(--thumb-w) * var(--a4-ratio));
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(var(--thumb-w), var(--thumb-w)));
  grid-auto-rows: var(--card-h);
  gap: var(--thumb-gap);
  justify-content: start;
  align-content: start;
  grid-auto-flow: row dense;
}

.preview-grid.thumb-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(var(--thumb-w), var(--thumb-w)));
  grid-auto-rows: var(--card-h);
  gap: var(--thumb-gap);
  justify-content: start;
  align-content: start;
  grid-auto-flow: row dense;
}

#preview-split > *,
.preview-grid.thumb-list > * {
  inline-size: var(--thumb-w) !important;
  block-size: var(--card-h) !important;
  width: auto !important;
  max-width: none !important;
  flex: 0 0 auto !important;
  grid-column: auto !important;
}

/* -------------------- THUMB -------------------- */
.page-wrapper.page-thumb {}

.thumb-card {
  position: relative;
  display: flex;
  flex-direction: column;
  gap: .5rem;
  padding: .5rem;
  inline-size: var(--thumb-w);
  block-size: var(--card-h);
  background: var(--surface, #fff);
  border: 1px solid var(--glass-border, rgba(0,0,0,.08));
  border-radius: .75rem;
  box-shadow: 0 1px 2px rgba(0,0,0,.06);
  cursor: pointer;
  transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
  overflow: hidden;
  outline: 0;

  &:hover { transform: translateY(-1px); }
  &:focus-visible { box-shadow: 0 0 0 3px rgba(0,153,93,.35); }
}

.page-wrapper.page-thumb.is-selected,
.thumb-card.is-selected {
  border-color: var(--primary, #00995d);
  box-shadow: 0 0 0 2px rgba(0,153,93,.35);
}
.page-wrapper.page-thumb[tabindex="0"]:focus,
.thumb-card[tabindex="0"]:focus {
  box-shadow: 0 0 0 2px var(--primary, #00995d);
}

/* -------------------- BADGES -------------------- */
.page-wrapper.page-thumb .page-badge,
.thumb-card .page-badge {
  position: absolute;
  inset-block-start: .35rem;
  inset-inline-start: .35rem;
  z-index: 3;
  background: var(--primary, #00995d);
  color: #fff;
  font-weight: 700;
  font-size: .78rem;
  line-height: 1;
  border-radius: .45rem;
  padding: .25rem .5rem;
  pointer-events: none;
  box-shadow: 0 1px 3px rgba(0,0,0,.15);
}

.select-check {
  position: absolute;
  top: .35rem;
  right: .35rem;
  width: 22px; height: 22px;
  border-radius: .5rem;
  border: 1px solid var(--glass-border, rgba(0,0,0,.2));
  background: rgba(0,0,0,.35);
  color: #fff;
  display: grid;
  place-items: center;
  font-weight: 800;
  font-size: .8rem;
  pointer-events: none;
  opacity: 0;
  transform: scale(.9);
  transition: opacity .1s, transform .1s;
}
.page-wrapper.page-thumb.is-selected .select-check,
.thumb-card.is-selected .select-check {
  opacity: 1;
  transform: scale(1);
  background: var(--primary, #00995d);
}

/* -------------------- CONTROLES -------------------- */
.file-controls,
.thumb-actions { display: inline-flex; gap: .25rem; }

.file-controls .remove-file,
.file-controls .rotate-page,
.file-controls .open-editor,
.file-controls [data-action="open-editor"],
.file-controls .crop-page,
.thumb-actions .remove-file,
.thumb-actions .rotate-page,
.thumb-actions .open-editor,
.thumb-actions [data-action="open-editor"],
.thumb-actions .crop-page,
/* Reaproveitar o MESMO botão na sidebar */
.tool__sidebar .file-item .remove-file {
  border: 1px solid var(--glass-border, rgba(0,0,0,.25));
  background: rgba(0,0,0,.78);
  color: #fff;
  border-radius: .5rem;
  padding: .2rem .35rem;
  inline-size: 26px;
  block-size: 26px;
  line-height: 0;
  cursor: pointer;
  display: grid;
  place-items: center;
  transition: transform .14s ease, background .14s ease, opacity .14s ease;

  &:hover { transform: scale(1.06); background: rgba(0,0,0,.86); }
  &:active { transform: scale(.98); }
}

.page-wrapper.page-thumb .file-controls,
.thumb-card .file-controls {
  position: absolute;
  inset-block-start: .35rem;
  inset-inline-end: .35rem;
  z-index: 4;
}

/* ✎ oculto globalmente (visível só no /edit via regras abaixo) */
.file-controls .open-editor,
.file-controls [data-action="open-editor"],
.file-controls .crop-page,
.thumb-actions .open-editor,
.thumb-actions [data-action="open-editor"],
.thumb-actions .crop-page { display: none !important; }

#preview-edit.preview.preview--grid .file-controls .open-editor,
#preview-edit.preview.preview--grid .file-controls [data-action="open-editor"],
#preview-edit.preview.preview--grid .file-controls .crop-page,
#preview-edit.preview.preview--grid .thumb-actions .open-editor,
#preview-edit.preview.preview--grid .thumb-actions [data-action="open-editor"],
#preview-edit.preview.preview--grid .thumb-actions .crop-page {
  display: grid !important;
}

/* /merge: só ↻ e × */
#preview-merge .file-controls > :not(.remove-file):not(.rotate-page),
.preview-grid.thumb-list .file-controls > :not(.remove-file):not(.rotate-page),
#preview-merge .thumb-actions  > :not(.remove-file):not(.rotate-page),
.preview-grid.thumb-list .thumb-actions  > :not(.remove-file):not(.rotate-page) {
  display: none !important;
}

/* -------------------- MÍDIA --------------------
   Padrão: .thumb-media → .thumb-frame → canvas/img
   MERGE:   .thumb-frame > img.thumb-media (fit/rotate controlado no JS)
------------------------------------------------------------------ */
.page-wrapper.page-thumb .thumb-media,
.thumb-card .thumb-media {
  position: absolute;
  inset: 0;
  display: block;
  transform: none;
  backface-visibility: hidden;
}

.page-wrapper.page-thumb .thumb-frame,
.thumb-card .thumb-frame {
  position: absolute;
  inset: 0;
  inline-size: 100%;
  block-size: 100%;
  background: #fff;
  overflow: hidden;
  display: block;
  will-change: transform;
  contain: paint;
  border-radius: .6rem;
}

.page-wrapper.page-thumb .thumb-frame > canvas,
.page-wrapper.page-thumb .thumb-frame > img,
.thumb-card .thumb-frame > canvas,
.thumb-card .thumb-frame > img {
  width: 100%;
  height: auto;
  display: block;
  background: #fff;
  border: 0;
}

/* MERGE: a imagem real é a .thumb-media dentro do frame (sem crop forçado) */
#preview-merge .thumb-frame > .thumb-media {
  position: absolute;
  top: 50%;
  left: 50%;
  inset: auto;
  transform: translate(-50%, -50%); /* rotate/scale vem do JS (fitRotateMedia) */
  transform-origin: 50% 50%;
  width: auto;
  height: auto;
  max-width: none;
  max-height: none;
  will-change: transform;
  background: transparent;
}

/* Anti-serrilhado (Chrome) quando em 90/270) */
@supports (filter: blur(0.001px)) {
  .thumb-media[style*="rotate(90deg)"],
  .thumb-media[style*="rotate(270deg)"],
  .thumb-frame[style*="rotate(90deg)"],
  .thumb-frame[style*="rotate(270deg)"] { filter: blur(0.001px); }
}

/* -------------------- OVERLAYS CROP -------------------- */
.gv-crop-overlay { position: absolute; inset: 0; cursor: crosshair; pointer-events: auto; touch-action: none; z-index: 2; }
.gv-crop-rect     { position: absolute; border: 2px dashed currentColor; color: #09a36b; background-color: rgba(0,0,0,.08); box-sizing: border-box; pointer-events: none; }
.gv-crop-badge    { position: absolute; top: .35rem; left: .35rem; background: #09a36b; color:#fff; font-size:.72rem; padding:.15rem .35rem; border-radius:.4rem; z-index:3; }

/* -------------------- ÍCONES (X / ↻ / ✎) -------------------- */
.file-controls .remove-file::before,
.thumb-actions .remove-file::before,
.tool__sidebar .file-item .remove-file::before {
  content: "";
  display: block;
  width: 16px; height: 16px;
  background-repeat: no-repeat;
  background-position: center;
  background-size: 16px 16px;
  background-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'>\
<g stroke='%23fff' stroke-width='3' stroke-linecap='round'>\
<path d='M6 6 L18 18'/><path d='M6 18 L18 6'/></g></svg>");
}

.file-controls .rotate-page::before,
.preview-grid.thumb-list .file-controls .rotate-page::before,
.thumb-actions .rotate-page::before {
  content: "";
  display: block;
  width: 16px; height: 16px;
  background-repeat: no-repeat;
  background-position: center;
  background-size: 16px 16px;
  background-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'>\
<path fill='%23fff' d='M12 5a7 7 0 1 1-6.32 4H3l3.5-3.5L10 9H7.66A5 5 0 1 0 12 7V5z'/></svg>");
}

/* -------------------- SIDEBAR: lista “Organizar” -------------------- */
.tool__sidebar .file-item {
  display: grid;
  grid-template-columns: auto auto 1fr auto auto; /* handle | tag | name | meta | X */
  align-items: center;
  gap: .5rem;
  padding: .35rem .5rem;
  border-radius: .5rem;
}

.tool__sidebar .file-item .handle {
  font-weight: 700;
  opacity: .6;
  cursor: grab;
  user-select: none;
}

.tool__sidebar .file-item .tag {
  display: inline-grid;
  place-items: center;
  width: 22px; height: 22px;
  border-radius: 999px;
  background: var(--primary-weak, #e7fff5);
  color: var(--primary, #00995d);
  font-weight: 700;
  font-size: .8rem;
}

.tool__sidebar .file-item .meta { font-size: .82rem; opacity: .85; }

.tool__sidebar .file-item.drop-highlight { outline: 1.5px dashed var(--primary, #00995d); }
.tool__sidebar .file-item.is-dragging   { opacity: .75; }

/* -------------------- RESPONSIVO -------------------- */
@media (max-width: 900px) {
  .with-preview .upload-preview-wrapper { grid-template-columns: 1fr; }
  .with-preview .preview-column { position: static; }
  .with-preview .preview-column .preview-grid { max-height: none; }
}