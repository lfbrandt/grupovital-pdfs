/* ===================================================================
   Preview Grid — miniaturas do /edit
   — ESCOPADO para #preview-edit (não atinge #preview-merge)
=================================================================== */

#preview-edit.preview.preview--grid {
  --preview-thumb-min: var(--preview-thumb-min, 120px);
  --preview-gap: var(--preview-gap, .5rem);

  /* ===== TOKENS DE CONTROLE ===== */
  --ctrl-size: 26px;
  --ctrl-gap: 10px;
  --ctrl-offset: 8px;
  --ctrl-float: -12px;

  --ctrl-bg: rgba(255,255,255,.92);
  --ctrl-ico: var(--gv-text, #0f1412);
  --ctrl-bd: rgba(0,0,0,.12);
  --ctrl-bg-hover: var(--gv-brand, #00995d);
  --ctrl-ico-hover: #ffffff;
  --ctrl-bd-hover: #007a4a;

  --focus-ring: 0 0 0 3px rgba(0,153,93,.35);

  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(var(--preview-thumb-min), 1fr));
  gap: var(--preview-gap);
  align-content: start;

  isolation: isolate;
  transform: translateZ(0);
  will-change: contents;

  background: var(--gv-surface-2);
  border: 1px solid var(--gv-card-bd);
  border-radius: 14px;
  padding: .5rem;
  min-height: 280px;
  overflow: auto;
}

/* DARK */
html[data-theme="dark"] #preview-edit.preview.preview--grid {
  --ctrl-bg: rgba(20,22,21,.80);
  --ctrl-ico: #eef3f1;
  --ctrl-bd: rgba(255,255,255,.18);
  --ctrl-bg-hover: var(--gv-brand, #00995d);
  --ctrl-ico-hover: #ffffff;
  --ctrl-bd-hover: rgba(255,255,255,.35);
}

/* Wrapper opcional criado pelo JS */
#preview-edit.preview.preview--grid .preview-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(var(--preview-thumb-min, 120px), 1fr));
  gap: var(--preview-gap, .5rem);
  align-content: start;
}

/* Miniatura */
#preview-edit.preview.preview--grid > .page-wrapper,
#preview-edit.preview.preview--grid > .preview__item,
#preview-edit.preview.preview--grid .preview-grid > .page-wrapper,
#preview-edit.preview.preview--grid .preview-grid > .preview__item {
  background: var(--gv-surface-2);
  border: 1px solid var(--gv-card-bd);
  border-radius: 12px;
  overflow: visible;           /* permite os botões “subirem” */
  position: relative;
  width: auto !important;
  min-width: 0;
  transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
  box-shadow: 0 1px 2px rgba(0,0,0,.06);
}

/* Seleção verde */
#preview-edit .preview__item.is-selected,
#preview-edit .page-wrapper.is-selected {
  border-color: #00995d;
  box-shadow: 0 0 0 2px rgba(0,153,93,.25), 0 1px 2px rgba(0,0,0,.06);
}

/* Hover */
#preview-edit.preview.preview--grid > .page-wrapper:hover,
#preview-edit.preview.preview--grid > .preview__item:hover,
#preview-edit.preview.preview--grid .preview-grid > .page-wrapper:hover,
#preview-edit.preview.preview--grid .preview-grid > .preview__item:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 18px rgba(0,0,0,.18);
  border-color: rgba(0,0,0,.12);
}

/* Imagem/canvas — grade estável (APENAS no #preview-edit) */
#preview-edit.preview.preview--grid canvas,
#preview-edit.preview.preview--grid img {
  display: block;
  width: 100%;
  height: auto;
  aspect-ratio: 0.707 / 1; /* ~A4 */
  object-fit: cover;
  border-radius: 10px;
  overflow: hidden;
}

/* ================================================================
   CONTROLES (topo-direito) — incluindo .file-controls do seu HTML
================================================================ */
#preview-edit .preview__controls,
#preview-edit .thumb-actions,
#preview-edit .file-controls {
  position: absolute;
  top: calc(var(--ctrl-offset) + var(--ctrl-float));
  right: var(--ctrl-offset);
  left: auto !important;
  z-index: 3;
  display: flex;
  flex-wrap: nowrap;
  gap: var(--ctrl-gap);
  align-items: center;
  justify-content: flex-end;
  pointer-events: none;
  max-width: calc(100% - (var(--ctrl-offset) * 2));
  filter: drop-shadow(0 2px 6px rgba(0,0,0,.12));
}

#preview-edit .preview__controls .btn,
#preview-edit .thumb-actions .btn,
#preview-edit .file-controls .btn,
#preview-edit .preview__controls button,
#preview-edit .thumb-actions button,
#preview-edit .file-controls button,
#preview-edit .preview__controls [role="button"],
#preview-edit .thumb-actions [role="button"],
#preview-edit .file-controls [role="button"] {
  pointer-events: auto;
  width: var(--ctrl-size);
  height: var(--ctrl-size);
  min-width: var(--ctrl-size);
  min-height: var(--ctrl-size);
  border-radius: 999px;
  border: 1px solid var(--ctrl-bd);
  background: var(--ctrl-bg);
  color: var(--ctrl-ico);
  display: grid;
  place-items: center;
  box-shadow: 0 1px 3px rgba(0,0,0,.18);
  outline: none;
  cursor: pointer;
  transition: border-color .15s ease, background-color .15s ease, color .15s ease, box-shadow .15s ease, transform .12s ease;

  -webkit-backdrop-filter: saturate(1.2) blur(4px);
  backdrop-filter: saturate(1.2) blur(4px);
}

/* Ícones via ::before (herda currentColor) */
#preview-edit .preview__controls .btn::before,
#preview-edit .thumb-actions .btn::before,
#preview-edit .file-controls .btn::before,
#preview-edit .preview__controls button::before,
#preview-edit .thumb-actions button::before,
#preview-edit .file-controls button::before,
#preview-edit .preview__controls [role="button"]::before,
#preview-edit .thumb-actions [role="button"]::before,
#preview-edit .file-controls [role="button"]::before {
  content: "";
  width: 16px;
  height: 16px;
  background: currentColor;
  -webkit-mask: var(--ico) no-repeat center / contain;
          mask: var(--ico) no-repeat center / contain;
}

@media (hover: hover) {
  #preview-edit .preview__controls .btn:hover,
  #preview-edit .thumb-actions .btn:hover,
  #preview-edit .file-controls .btn:hover,
  #preview-edit .preview__controls button:hover,
  #preview-edit .thumb-actions button:hover,
  #preview-edit .file-controls button:hover {
    background: var(--ctrl-bg-hover);
    border-color: var(--ctrl-bd-hover);
    color: var(--ctrl-ico-hover);
    box-shadow: 0 2px 6px rgba(0,0,0,.25);
    transform: translateY(-1px);
  }
}

#preview-edit .preview__controls .btn:focus-visible,
#preview-edit .thumb-actions .btn:focus-visible,
#preview-edit .file-controls .btn:focus-visible,
#preview-edit .preview__controls button:focus-visible,
#preview-edit .thumb-actions button:focus-visible,
#preview-edit .file-controls button:focus-visible {
  box-shadow: var(--focus-ring);
}

/* Durante drag */
#preview-edit .preview__item.is-dragging .preview__controls,
#preview-edit .page-wrapper.is-dragging .thumb-actions,
#preview-edit .page-wrapper.is-dragging .file-controls {
  opacity: .75;
}

/* ÍCONES (mapas) — só no /edit */
#preview-edit .file-controls .crop-page{
  --ico: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23000' d='M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.42L18.37 3.29a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.83z'/></svg>");
}
#preview-edit .file-controls .rotate-page{
  --ico: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23000' d='M7 7h7v2H8.41l1.3 1.29-1.42 1.42L4.59 8l3.7-3.71 1.42 1.42L8.41 7zM12 13h5v-2h-3.59l1.3-1.29-1.42-1.42L9.59 12l3.7 3.71 1.42-1.42L13.41 13H12z'/></svg>");
}
#preview-edit .file-controls .remove-file{
  --ico: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23000' d='M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z'/></svg>");
}

/* Badge + Spinner */
#preview-edit .badge {
  position: absolute;
  z-index: 2;
  bottom: 8px;
  right: 8px;
  background: rgba(0,0,0,.55);
  color: #fff;
  padding: .15rem .45rem;
  font-size: .75rem;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.15);
}

#spinner-edit,
#preview-edit .spinner {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  background: linear-gradient(0deg, rgba(0,0,0,.35), rgba(0,0,0,.35));
  border-radius: 12px;
}
#spinner-edit.hidden,
#preview-edit .spinner.hidden {
  display: none !important;
}